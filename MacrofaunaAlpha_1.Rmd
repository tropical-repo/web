---
title: "1. Macrofauna Alpha Diversity"
description: |
  Reproducible workflow for ... In this workflow, ....
author:
#  - name: Noelle Lucey
#    url: https://example.com/norajones
#    affiliation: Spacely Sprockets
#    affiliation_nrl: https://example.com/spacelysprokets
# bibliography: assets/cite.bib
output:
    distill::distill_article:
     # css: assets/styles.css
      toc: true
      toc_depth: 3
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE, eval = FALSE)

library(vegan)
library(ggplot2)
library(viridis)
library(cowplot)
library(mvabund) 
library(devtools)
library(codefolder)

#options(scipen=999)
#knitr::opts_current$get(c(
#  "cache",
#  "cache.path",
#  "cache.rebuild",
#  "dependson",
#  "autodep"
#))
```

> Hit the *Hide Code* button to hide the R code (shown by default).

<aside>
#```{r codefolder_ssu18, echo=FALSE, results='asis', eval=TRUE}
#codefolder::generic(init = "show", query = "pre.sourceCode",
#  style = "position: absolute; right: 14%; z-index: 200")
#```
</aside>

```{r data, include=FALSE}
ds <- read.csv("T_REPO_raw.csv", header = TRUE)
ds <- ds[ds$size == "combined",] # select combinded size fraction
ds <- ds[ds$total_organisms != "0",] # # remove any samples without animals

ds.data <- ds[,16:32] # species matrix
env.data <- ds[,34:40] # temp, DO %, DO mgL, pH, chloro, bga
site.data <- ds[,1:6] # site, region, season, week, Region, season

# Data Exploration with truncated data set, from dates matching microbial samples
# This is the sum of occurrences at each site, in each season every other week (based on microbial sampling); environmental data is averaged by season and site
short <- read.csv("macro_short1.csv", header = TRUE)

short.data <- short[,13:29] # species
env_s.data <- short[,31:39] # temp, DO %, DO mgL, pH, chloro, bga
site_s.data <- short[,1:3] # site, region, season
boxplot(ds[,13:29],horizontal = TRUE,las=2, main="Total Live Organisims (lower level groups)") # select higher level taxonomic groups
```

# Calculate Alpha diversity

<hr/>

-   Shannon's H'

-   Observed Richness (\# of species)

-   Pielou's Evenness

-   Inverse Simpson

-   Renyi's Entropy

    <hr/>

```{r, alpha caluculations}
# Shannon's H'
H_short <- diversity(short.data)
H_long <- diversity(ds.data)

# Observed Richness
richness_short <- specnumber(short.data)  
richness_long <- specnumber(ds.data) 

# Pielou's Evenness
evenness_short <- H_short/log(richness_short)
evenness_long <- H_long/log(richness_long)

# Inverse simpson
D2 <- diversity(ds.data, index = "invsimpson", base = 2)

# Renyi entropy as diversity measure
R <- renyi(ds.data, scales = 2)
N2 <- renyi(ds.data, scales = 2, hill = TRUE)  # inverse simpson
k <- sample(nrow(ds.data), 6)
R <- renyi(ds.data[k,])

Rs <- renyi(short.data, scales = 2)
N2s <- renyi(short.data, scales = 2, hill = TRUE)  # inverse simpson
ks <- sample(nrow(short.data), 6)
Rs <- renyi(short.data[ks,])

#layout(matrix(1:2, ncol = 2))
plot(R, main = "Renyi plot full data; 6 random samples")
plot(Rs, main = "short renyi plot")
#layout(1)

# Create alpha diversity dataframe including environmental data
# long data 
alpha <- cbind(shannon = H_long, richness = richness_long, pielou = evenness_long, env.data, site.data)
head(alpha)
# short data
alpha_s <- cbind(shannon = H_short, richness = richness_short, pielou = evenness_short, env_s.data, site_s.data)

```

# Plot Alpha Diversity

```{r, alpha plots full}
plot.shan <- ggplot(alpha, aes(x = site, y = shannon, colour = site)) +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  ylab("Shannon's H'") + 
  xlab("") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))

plot.rich <-ggplot(alpha, aes(x = site, y = richness, colour = site)) +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  ylab("Species Richness") +
  xlab("") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))


plot.even <- ggplot(alpha, aes(x = site, y = pielou, colour = site)) +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  ylab("Pielou's Evenness") +
  xlab("") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))
legend <- get_legend(plot.even)

plot_grid(plot.shan + theme(legend.position = "none"), 
          plot.rich + theme(legend.position = "none"), 
          plot.even + theme(legend.position = "none"), ncol = 3)

```

<br/>

```{R, short alpha plots}

plot.shan <- ggplot(alpha_s, aes(x = site, y = shannon, colour = site, shape = season)) +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  ylab("Shannon's H'") + 
  xlab("") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))

plot.rich <-ggplot(alpha_s, aes(x = site, y = richness, colour = site, shape = season)) +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  ylab("Species Richness") +
  xlab("") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))

plot.even <- ggplot(alpha_s, aes(x = site, y = pielou, colour = site, shape = season)) +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  ylab("Pielou's Evenness") +
  xlab("") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))
legend <- get_legend(plot.even)

plot_grid(plot.shan + theme(legend.position = "none"), 
          plot.rich + theme(legend.position = "none"), 
          plot.even + theme(legend.position = "none"),
          legend, rel_heights = c(1,1,1,0.5), ncol = 4)

```

These graphs illustrate the differences between alpha diversity metrics and the relationship between species richness, Pielou's evenness, and Shannon's H'. Punta Caracol and Pastores are two sites with similar Shannon's H' scores, however, this is resultant of distinct mechanisms. P. Caracol has a large number of species (high species richness) but is relatively uneven (low Pielou's Evenness), resulting in a moderate Shannon's H'. Pastores, in contrast, has a small number of species but is very even, also resulting in a moderate Shannon's H'. Alpha diversity is structured very differently at P. Caracol compared with Pastores, but if we had used Shannon's H' alone we may not have identified these important differences.

Almirante has relatively how Shannon's H', which is matched by low species richness and high evenness. From the large difference between the Cristobal point, it appears that the season is important in driving alpha diversity measures (H', richness and evenness to a lesser extent).

# Alpha diversity and environment

Simple linear models between:

    A)  shannon diversity
    B)  richness
    C)  Evennness

<!-- -->
1.  Temperature (C)
2.  Salinity (psu),
3.  Dissolved Oxygen (mg/L)
4.  pH
5.  Chlorophyll concentration (ug/L)
6.  Cyanobacteria/Blue Green Algae concentration (ug/L)

First, assess the shannon diversity relationship.s

```{R, abundance-environment relationships, eval=FALSE, echo=TRUE}
summary(lm(shannon ~ temp, alpha))
summary(lm(shannon ~ sal_psu, alpha)) 
summary(lm(shannon ~ DO_mgL, alpha)) # positive, sig. ***
summary(lm(shannon ~ pH, alpha)) # positive, sig. ***
summary(lm(shannon ~ as.numeric(Chlorophyll_ugL), alpha)) 
summary(lm(shannon ~ as.numeric(BGA_ugL), alpha)) 

alpha1 <- alpha[alpha$season != "HS",] # normoxic season
summary(lm(shannon ~ temp, alpha1))
summary(lm(shannon ~ sal_psu, alpha1)) 
summary(lm(shannon ~ DO_mgL, alpha1)) # positive, sig. ***
summary(lm(shannon ~ pH, alpha1)) 
summary(lm(shannon ~ as.numeric(Chlorophyll_ugL), alpha1))  # why is this not numeric?
summary(lm(shannon ~ as.numeric(BGA_ugL), alpha1)) # negative, sig * 

alpha2 <- alpha[alpha$season == "HS",] #hypoxic season
summary(lm(shannon ~ temp, alpha2))
summary(lm(shannon ~ sal_psu, alpha2)) # negative, sig. ** 
summary(lm(shannon ~ DO_mgL, alpha2)) # positive, sig. ***
summary(lm(shannon ~ pH, alpha2)) # positive, sig. ***
summary(lm(shannon ~ as.numeric(Chlorophyll_ugL), alpha2)) 
summary(lm(shannon ~ as.numeric(BGA_ugL), alpha2)) 
```

The linear model outputs demonstrate that there is a significant relationship between DO and pH and Shannon's H' in the full dataset. DO is important in the normoxic season, as is BGA. However during the hypoxic season additional environmental variables become important. These include salinity and pH, but not BGA.

Linear model outputs demonstrate a significant positive relationship between both pH and DO and richness across Almirante Bay. We can then fit the significant regression lines to our plots using the geom_smooth function in the r package ggplot2.

```{R, abundance plots}

DO.H <- ggplot(alpha_s, aes(x = DO_mgL, y = shannon, colour = site)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab(bquote(DO ~ (mg~L^-1))) + 
  ylab("") +
 # ylim(5,15) +
  theme_bw()

sal.H <- ggplot(alpha_s, aes(x = sal_psu, y = shannon, colour = site, shape = season)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab(bquote(salinity ~ (psu))) + 
  ylab("") +
 # ylim(5,15) +
  theme_bw()

pH.H <- ggplot(alpha_s, aes(x = pH, y = shannon, colour = site)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey85") +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab("pH") + 
  ylab("") +
 # ylim(5,15) +
  theme_bw()

bga.H <- ggplot(alpha_s, aes(x = BGA_ugL, y = shannon, colour = site, shape = season)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab("BGA (ugL)") + 
  ylab("") +
  #ylim(5,15) +
  theme_bw()
legend <- get_legend(bga.H)

plot_grid(DO.H + theme(legend.position = 'none'),
          pH.H + theme(legend.position = 'none'),
          sal.H + theme(legend.position = 'none'), 
          bga.H + theme(legend.position = 'none'),
          legend, rel_heights = c(1,1,1,1,0.5),  ncol = 5)
```

Now we look at the same relationships with respect to species richness.

```{R, richness~environment, eval=FALSE, echo=TRUE}

summary(lm(richness ~ temp, alpha))
summary(lm(richness ~ sal_psu, alpha)) # negative, sig.* higher richness with more rain
summary(lm(richness ~ DO_mgL, alpha)) # positive, sig.*** - higher richness with more oxygen
summary(lm(richness ~ pH, alpha)) # positive, sig.*** - higher richness with less acidity
summary(lm(richness ~ as.numeric(Chlorophyll_ugL), alpha)) 
summary(lm(richness ~ as.numeric(BGA_ugL), alpha)) 

alpha1 <- alpha[alpha$season != "HS",] # normoxic season
summary(lm(richness ~ temp, alpha1)) 
summary(lm(richness ~ sal_psu, alpha1)) 
summary(lm(richness ~ DO_mgL, alpha1)) # positive, sig.***
summary(lm(richness ~ pH, alpha1)) 
summary(lm(richness ~ as.numeric(Chlorophyll_ugL), alpha1)) # negative, sig.* - less richness with more chlorophyl
summary(lm(richness ~ as.numeric(BGA_ugL), alpha1)) # negative, sig.* - less richness with more BGA

alpha2 <- alpha[alpha$season == "HS",] #hypoxic season
summary(lm(richness ~ temp, alpha2))
summary(lm(richness ~ sal_psu, alpha2)) # negative, sig.*** - less richness with higher salinity 
summary(lm(richness ~ DO_mgL, alpha2)) # positive, sig.*** - higher richness with more oxgyen
summary(lm(richness ~ pH, alpha2)) # positive, sig.*** - higher richness with higher pH
summary(lm(richness ~ as.numeric(Chlorophyll_ugL), alpha2))
summary(lm(richness ~ as.numeric(BGA_ugL), alpha2)) 
```

Salinity, oxygen and pH have the greatest effect on species richness. During the normoxic season, increasing chlorophyll and BGA levels correspond to decreasing richness. This is not true in the hypoxic season (no relationship).

Here we can see these relationships by plotting species richness against pH, DO, saliniy, BGA, and chlorophyll.

```{R, richness plots}

DO.rich <- ggplot(alpha_s, aes(x = DO_mgL, y = richness, colour = site)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab(bquote(DO ~ (mg~L^-1))) + 
  ylab("Species Richness") +
  ylim(5,15) +
  theme_bw()

sal.rich <- ggplot(alpha_s, aes(x = sal_psu, y = richness, colour = site)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab(bquote(salinity ~ (psu))) + 
  ylab("") +
  ylim(5,15) +
  theme_bw()

pH.rich <- ggplot(alpha_s, aes(x = pH, y = richness, colour = site)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey85") +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab("pH") + 
  ylab("") +
  ylim(5,15) +
  theme_bw()
str(alpha_s)

chloro.rich <- ggplot(alpha_s, aes(x = Chlorophyll_ugL, y = richness, colour = site, shape=season)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab("Chlorophyll (ug/L)") + 
  ylab("") +
  ylim(5,15) +
  theme_bw()

bga.rich <- ggplot(alpha_s, aes(x = BGA_ugL, y = richness, colour = site, shape=season)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab("BGA (ug/L)") + 
  ylab("") +
  ylim(5,15) +
  theme_bw()
legend <- get_legend(bga.rich)

plot_grid(DO.rich + theme(legend.position = 'none'),
          pH.rich + theme(legend.position = 'none'), 
          sal.rich + theme(legend.position = 'none'), 
          chloro.rich + theme(legend.position = 'none'), 
          bga.rich + theme(legend.position = 'none'), 
          legend, rel_heights = c(1,1,1,1,1,0.5),  ncol = 6)
```

Check the evenness and environmental parameters:

```{R,  evennness~environment, eval=FALSE, echo=TRUE}
summary(lm(pielou ~ temp, alpha))
summary(lm(pielou ~ sal_psu, alpha)) # positive, significant - higher evenness with more saline
summary(lm(pielou ~ DO_mgL, alpha)) # negative, significant - lower evenness with more oxygen
summary(lm(pielou ~ pH, alpha)) 
summary(lm(pielou ~ as.numeric(Chlorophyll_ugL), alpha)) 
summary(lm(pielou ~ as.numeric(BGA_ugL), alpha)) 

alpha1 <- alpha[alpha$season != "HS",] # normoxic season
summary(lm(pielou ~ temp, alpha1)) 
summary(lm(pielou ~ sal_psu, alpha1)) # positive, significant - higher evenness with higher salinity
summary(lm(pielou ~ DO_mgL, alpha1)) 
summary(lm(pielou ~ pH, alpha1)) 
summary(lm(pielou ~ as.numeric(Chlorophyll_ugL), alpha1)) 
summary(lm(pielou ~ as.numeric(BGA_ugL), alpha1)) 

alpha2 <- alpha[alpha$season == "HS",] #hypoxic season
summary(lm(pielou ~ temp, alpha2))
summary(lm(pielou ~ sal_psu, alpha2)) # marginally significant
summary(lm(pielou ~ DO_mgL, alpha2)) # marginally significant
summary(lm(pielou ~ pH, alpha2)) 
summary(lm(pielou ~ as.numeric(Chlorophyll_ugL), alpha2)) # marginally significant
summary(lm(pielou ~ as.numeric(BGA_ugL), alpha2)) # negative, significant - low evenness with more BGA
```

Plots of Evenness

```{R, evenness plots}

DO.even <- ggplot(alpha_s, aes(x = DO_mgL, y = pielou, colour = site)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab(bquote(DO ~ (mg~L^-1))) + 
  ylab("Pielou's Evenness") +
  ylim(0.6,1) +
  theme_bw()

sal.even <- ggplot(alpha_s, aes(x = sal_psu, y = pielou, colour = site)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey90") +
  geom_point(size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab(bquote(salinity ~ (psu))) + 
  ylab("") +
  ylim(0.6,1) +
  theme_bw()

chloro.even <- ggplot(alpha_s, aes(x = Chlorophyll_ugL, y = pielou, colour = site, shape =season)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey85") +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab(bquote(Chlorophyll ~ (ug~L^-1))) + 
  ylab("") +
  ylim(0.6,1) +
  theme_bw()

bga.even <- ggplot(alpha_s, aes(x = BGA_ugL, y = pielou, colour = site, shape =season)) +
  geom_smooth(method = "lm", colour = "black", fill = "grey85") +
  geom_point(aes(shape = factor(season)), size = 3) +
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  xlab("BGA") + 
  ylab("") +
  ylim(0.6,1) +
  theme_bw()
legend <- get_legend(bga.even)

plot_grid(DO.even + theme(legend.position = 'none'), 
          sal.even + theme(legend.position = 'none'), 
          chloro.even + theme(legend.position = 'none'), 
          bga.even + theme(legend.position = 'none'), 
          legend, rel_heights = c(1,1,1,1,0.5),  ncol = 5)
```

# Analysis of Variance (ANOVA) for Factors

```{R, ANOVA Region}
anova <- aov(shannon ~ Region, alpha) #H'  significant
summary(anova)

anova <- aov(richness ~ Region, alpha) # significant
summary(anova)

anova <- aov(pielou ~ Region, alpha) # significant
summary(anova)


## Plots:

H_region <- ggplot(alpha, aes(x = Region, y = shannon, fill = Region)) +
  geom_boxplot(aes(fill = Region)) +
#  geom_point(size = 3, aes(colour = site)) + 
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  scale_fill_manual(values = c("grey60", "grey90"), guide = FALSE) +
  ylab("Shannon's H'") + 
  xlab('')+
  theme_bw()

Rich_region <- ggplot(alpha, aes(x = Region, y = richness, fill = Region)) +
  geom_boxplot(aes(fill = Region)) +
 # geom_point(size = 3, aes(colour = site)) + 
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  scale_fill_manual(values = c("grey60", "grey90"), guide = FALSE) +
  ylab("Species richness") + 
  xlab('Region')+
  theme_bw()

Even_region <- ggplot(alpha, aes(x = Region, y = pielou, fill = Region)) +
  geom_boxplot(aes(fill = Region)) +
  # geom_point(size = 3, aes(colour = site)) + 
  scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  scale_fill_manual(values = c("grey60", "grey90"), guide = FALSE) +
  ylab("Pielou evenness") + 
  xlab('')+
  theme_bw()

plot_grid(H_region + theme(legend.position = 'none'), 
          Rich_region + theme(legend.position = 'none'), 
          Even_region + theme(legend.position = 'none'), 
          rel_heights = c(1,1,1,0.5),  ncol = 3)

```

The one-way ANOVA reveals a significant relationship between region (a categorical variable) and richness and evenness but not Shannon's H'. Greater macrofaunal richness was observed in the outer bay compared to theinner bay.

# Seasonality 

Does seasonality impact abundance, richness and evenness?

```{R, season}

anova <- aov(shannon ~ season *site, alpha)
summary(anova)
anova <- aov(richness ~ season *site, alpha)
summary(anova)
anova <- aov(pielou ~ season *site, alpha)
summary(anova)
# nothing significant for season

season.plot <- ggplot(alpha, aes(x = season, y = shannon)) +
  geom_boxplot(aes(fill = Region)) +
  # geom_point(size = 3, aes(colour = site)) + 
  # scale_colour_viridis_d(option = "magma", begin = 0.2, end = 0.8) +
  scale_fill_manual(values = c("grey60", "grey90"), guide = FALSE) +
  ylab("Shannon's H'") + 
  xlab('season')+
  theme_bw() 
season.plot
```

No. Not for the whole bay, there are signs of site dependent effects however.

# Species composition

The mvabund approach improves power across a range of species with different variances and includes an assumption of a mean-variance relationship use the abundance data. First we convert the species data to an mvabund object format used by the mvabund package:

```{R, mvabund}

ds <- read.csv("T_REPO_raw.csv", header = TRUE)
ds <- ds[ds$size == "combined",] # select combinded size fraction
ds <- ds[ds$total_organisms != "0",] # # remove any samples without animals

ds_spp <- mvabund(ds[,16:32]) 
# site.data <- ds[,1:6] # site, region, season, week, Region, season
# env <- mvabund(ds[,34:38]) # env.data <- ds[,34:40] # temp, DO %, DO mgL, pH, chloro, bga

```

Then we fit predictive models using a negative binomial model for counts.

```{R, model}
site <- factor(ds$site)
model <- manyglm(ds_spp ~ site, family="negative_binomial")
anova(model) # use this model
```

Check our model assumptions,

```{R, assumptions}
model1_res_plot <- plot(model) # best with neg. binomial
```

The residuals look good with the negative binomial distribution (i.e no patterns detectable).

Then we perform pairwise comparisons to determine which sites are different from each other? For the paper, increase the nBoot to 999.

```{R, pairwisel}
anova(model, pairwise.comp = site, nBoot = 199)
```

Every site is different from the other, except Almirante and Pastores.

To determine which species are important in this we run univariate tests for each species separately.

```{R, univariate tests}
M1_uni <- anova(model, p.uni="adjusted") 
M1_uni
```

Echinoidea, Decapoda, and Copepoda are not significantly different between sites or O_Cladocera or C_Scaphopoda.

Check seasonality for differences in species abundances'. Testing hypotheses about the region effect and region-by-season interactions, again using a Wald statistic and 199 resamples (better to ramp up to 999 for the paper):

```{R, interactions}
M2 <- manyglm(ds_spp ~ ds$Region * ds$season, family="negative_binomial")
anova(M2)

```

There were different species assemblages in the different regions (LRT = 710, P\< 0.001) and during different seasons (LRT = 89.6, P \< 0.001). There was also an interaction between region and season (LRT = 55, P \< 0.003).

Again, which species is important in the interaction?

```{R, univariate interactions}
M2_uni <- anova(M2, p.uni="adjusted") 
M2_uni
```

Errantia has a significant interaction between region and season indicating maybe they repopulate quickly, or be more transient (LRT = 18, P = 0.002). This may be a good indicator of the environmental conditions changing. Regional differences are more prevalent (Sedentaria, Errantia/Aciculata, Ophiuroidea, Caudofoveata, Bivalvia, Amphipoda, Cumacea, Ostracod, Vertebrata, Sipuncula all have significally different abundances depending on the Region).

Taken another way, only Decapods, Copepods, Cladocera, Scaphopoda, Gastropoda and Echinoidae do not differ by region. Seasonally, the only category with any difference is the 'unknown' indicating we really need to look at total abundance across all taxa to see if there is any seasonality impacts.

```{R, mvabund plots}
plot.mvabund(ds_spp, factor(ds$site))

```
